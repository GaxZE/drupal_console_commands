# Usage: drupal site:compile:prod --placeholder="name:subscriptions" --placeholder="root:/vagrant/repos"
command:
  name: site:compile:artifact
  description: 'Compiles the source, downloading and extracting the packages.'
commands:
# Run composer
  - command: site:compose
    arguments:
      name: '%{{name}}'
    options:
      destination-directory: '%{{root|/vagrant/repos}}'
# Run npm
  - command: exec
    arguments:
      bin: 'cd %{{root|/vagrant/repos}}/web; find . -type d \( -name node_modules -o -name contrib -o -path ./core \) -prune -o -name package.json -execdir sh -c "npm install" \;'
# Run grunt
  - command: exec
    arguments:
      bin: 'cd %{{root|/vagrant/repos}}/web; find . -type d \( -name node_modules -o -name contrib -o -path ./core \) -prune -o -name Gruntfile.js -execdir sh -c "grunt" \;'
