# Usage: drupal site:rebuild --placeholder="name:subscriptions"
command:
  name: site:rebuild
  description: 'Performs multiple commands to build a site (without git checkout)'
commands:
# Run composer
  - command: site:compose
    arguments:
      name: '%{{name}}'
# Run npm
  - command: site:npm
    options:
      placeholder:
        - 'name:%{{name}}'
# Run grunt
  - command: site:grunt
    options:
      placeholder:
        - 'name:%{{name}}'
# Create settings.db.php
  - command: site:settings:db
    arguments:
      name: '%{{name}}'
# Enable development settings
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web/sites; cp -n ./example.settings.local.php ./default/settings.local.php;'
# Create phpunit.xml
  - command: site:phpunit:setup
    arguments:
      name: '%{{name}}'
# Create behat.yml
  - command: site:behat:setup
    arguments:
      name: '%{{name}}'
# Create settings.memcache.php
  - command: site:settings:memcache
    arguments:
      name: '%{{name}}'
# Imports db or installs a site
  - command: site:db:import
    arguments:
      name: '%{{name}}'
# Set default drush alias
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush site-set @vm;'
# Run db updates
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush updb -y;'
# Import configuration
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush cim -y;'
# Run db updates
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush updb -y;'
# Import configuration again to fix a problem with config import when new modules are added to core.extensions.yml
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush cim -y;'
# Clear cache
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush cr;'
